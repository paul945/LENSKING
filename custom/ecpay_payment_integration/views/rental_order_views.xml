<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        
        <!-- Êì¥ÂÖÖÁßüË≥ÉË®ÇÂñÆË°®ÂñÆË¶ñÂúñ -->
        <record id="view_sale_order_form_ecpay" model="ir.ui.view">
            <field name="name">sale.order.form.ecpay</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
                
                <!-- Âú® partner_id ÂæåÈù¢Âä†ÂÖ•‰ªòÊ¨æÁãÄÊÖã -->
                <xpath expr="//field[@name='partner_id']" position="after">
                    <field name="payment_state" 
                           widget="badge" 
                           decoration-success="payment_state == 'paid'"
                           decoration-warning="payment_state == 'waiting_payment'"
                           decoration-danger="payment_state == 'failed'"
                    />
                    <field name="source_channel"/>
                </xpath>

                <!-- Âä†ÂÖ•Á∂†Áïå‰ªòÊ¨æË≥áË®äÈ†ÅÁ±§ -->
                <xpath expr="//notebook" position="inside">
                    <page string="üí≥ ‰ªòÊ¨æË≥áË®ä" name="payment_info">
                        <group>
                            <group string="Á∂†Áïå‰∫§ÊòìË≥áË®ä">
                                <field name="payment_transaction_id" readonly="1"/>
                                <field name="payment_method" readonly="1"/>
                                <field name="payment_date" readonly="1"/>
                                <field name="payment_auto_registered" readonly="1"/>
                                <field name="payment_manual_verified"/>
                            </group>
                            
                            <group string="ATM ‰ªòÊ¨æË≥áË®ä" attrs="{'invisible': [('payment_method', 'not in', ['atm', 'web_atm'])]}">
                                <field name="atm_bank_code" readonly="1"/>
                                <field name="atm_v_account" readonly="1"/>
                                <field name="atm_expire_date" readonly="1"/>
                            </group>
                            
                            <group string="Ë∂ÖÂïÜ‰ªòÊ¨æË≥áË®ä" attrs="{'invisible': [('payment_method', 'not in', ['cvs', 'barcode'])]}">
                                <field name="cvs_payment_no" readonly="1"/>
                                <field name="cvs_expire_date" readonly="1"/>
                            </group>
                            
                            <group string="LINE Êï¥Âêà">
                                <field name="line_user_id"/>
                            </group>
                        </group>
                        
                        <group>
                            <field name="payment_note" colspan="2"/>
                        </group>
                        
                        <group string="‰ªòÊ¨æÈÄ£Áµê" attrs="{'invisible': [('payment_link', '=', False)]}">
                            <field name="payment_link" widget="url" readonly="1"/>
                            <div class="alert alert-info" role="alert">
                                ‚ÑπÔ∏è ÈªûÈÅ∏‰∏äÊñπÈÄ£ÁµêÂèØË§áË£ΩÔºåÊàñÁõ¥Êé•ÈªûÊìäÈñãÂïü‰ªòÊ¨æÈ†ÅÈù¢
                            </div>
                        </group>
                        
                        <div class="oe_button_box" name="button_box">
                            <button name="action_send_payment_link" 
                                    type="object" 
                                    string="ÁôºÈÄÅ‰ªòÊ¨æÈÄ£Áµê"
                                    class="oe_stat_button" 
                                    icon="fa-link"
                                    attrs="{'invisible': [('payment_state', 'in', ['paid', 'waiting_payment'])]}"/>
                            
                            <button name="action_verify_payment_manually" 
                                    type="object" 
                                    string="‰∫∫Â∑•Ë¶ÜÊ†∏"
                                    class="oe_stat_button" 
                                    icon="fa-check"
                                    attrs="{'invisible': ['|', ('payment_state', '!=', 'paid'), ('payment_manual_verified', '=', True)]}"/>
                        </div>
                    </page>
                </xpath>

            </field>
        </record>

        <!-- Êì¥ÂÖÖÁßüË≥ÉË®ÇÂñÆÊ®πÁãÄË¶ñÂúñ -->
        <record id="view_sale_order_tree_ecpay" model="ir.ui.view">
            <field name="name">sale.order.tree.ecpay</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_tree"/>
            <field name="arch" type="xml">
                
                <!-- Âú®ÁãÄÊÖãÊ¨Ñ‰ΩçÂæåÈù¢Âä†ÂÖ•‰ªòÊ¨æÁãÄÊÖã -->
                <xpath expr="//field[@name='state']" position="after">
                    <field name="payment_state" 
                           widget="badge"
                           decoration-success="payment_state == 'paid'"
                           decoration-warning="payment_state == 'waiting_payment'"
                           decoration-danger="payment_state == 'failed'"
                    />
                </xpath>

            </field>
        </record>

        <!-- Êì¥ÂÖÖÊêúÂ∞ãË¶ñÂúñ -->
        <record id="view_sale_order_search_ecpay" model="ir.ui.view">
            <field name="name">sale.order.search.ecpay</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_sales_order_filter"/>
            <field name="arch" type="xml">
                
                <!-- Âä†ÂÖ•‰ªòÊ¨æÁãÄÊÖãÁØ©ÈÅ∏ -->
                <xpath expr="//filter[@name='my_sale_orders_filter']" position="after">
                    <separator/>
                    <filter string="Êú™‰ªòÊ¨æ" name="not_paid" domain="[('payment_state', '=', 'not_paid')]"/>
                    <filter string="Á≠âÂæÖ‰ªòÊ¨æ" name="waiting_payment" domain="[('payment_state', '=', 'waiting_payment')]"/>
                    <filter string="Â∑≤‰ªòÊ¨æ" name="paid" domain="[('payment_state', '=', 'paid')]"/>
                    <filter string="‰ªòÊ¨æÂ§±Êïó" name="failed" domain="[('payment_state', '=', 'failed')]"/>
                    <separator/>
                    <filter string="LINE Bot Ë®ÇÂñÆ" name="line_bot" domain="[('source_channel', '=', 'line_bot')]"/>
                    <filter string="Ëá™ÂãïÂ∞çÂ∏≥" name="auto_registered" domain="[('payment_auto_registered', '=', True)]"/>
                </xpath>

                <!-- Âä†ÂÖ•Áæ§ÁµÑ -->
                <xpath expr="//group" position="inside">
                    <filter string="‰ªòÊ¨æÁãÄÊÖã" name="group_payment_state" context="{'group_by': 'payment_state'}"/>
                    <filter string="‰ªòÊ¨æÊñπÂºè" name="group_payment_method" context="{'group_by': 'payment_method'}"/>
                    <filter string="Ë®ÇÂñÆ‰æÜÊ∫ê" name="group_source_channel" context="{'group_by': 'source_channel'}"/>
                </xpath>

            </field>
        </record>

    </data>
</odoo>
